class GameCoordinator{constructor(){this.gameUi=document.getElementById("game-ui"),this.rowTop=document.getElementById("row-top"),this.mazeDiv=document.getElementById("maze"),this.mazeImg=document.getElementById("maze-img"),this.mazeCover=document.getElementById("maze-cover"),this.pointsDisplay=document.getElementById("points-display"),this.highScoreDisplay=document.getElementById("high-score-display"),this.extraLivesDisplay=document.getElementById("extra-lives"),this.fruitDisplay=document.getElementById("fruit-display"),this.mainMenu=document.getElementById("main-menu-container"),this.gameStartButton=document.getElementById("game-start"),this.pauseButton=document.getElementById("pause-button"),this.soundButton=document.getElementById("sound-button"),this.leftCover=document.getElementById("left-cover"),this.rightCover=document.getElementById("right-cover"),this.pausedText=document.getElementById("paused-text"),this.bottomRow=document.getElementById("bottom-row"),this.movementButtons=document.getElementById("movement-buttons"),this.mazeArray=[["XXXXXXXXXXXXXXXXXXXXXXXXXXXX"],["XooooooooooooXXooooooooooooX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XOXXXXoXXXXXoXXoXXXXXoXXXXOX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XooooooooooooooooooooooooooX"],["XoXXXXoXXoXXXXXXXXoXXoXXXXoX"],["XoXXXXoXXoXXXXXXXXoXXoXXXXoX"],["XooooooXXooooXXooooXXooooooX"],["XXXXXXoXXXXX XX XXXXXoXXXXXX"],["XXXXXXoXXXXX XX XXXXXoXXXXXX"],["XXXXXXoXX          XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX X      X XXoXXXXXX"],["      o   X      X   o      "],["XXXXXXoXX X      X XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX          XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XXXXXXoXX XXXXXXXX XXoXXXXXX"],["XooooooooooooXXooooooooooooX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XoXXXXoXXXXXoXXoXXXXXoXXXXoX"],["XOooXXooooooo  oooooooXXooOX"],["XXXoXXoXXoXXXXXXXXoXXoXXoXXX"],["XXXoXXoXXoXXXXXXXXoXXoXXoXXX"],["XooooooXXooooXXooooXXooooooX"],["XoXXXXXXXXXXoXXoXXXXXXXXXXoX"],["XoXXXXXXXXXXoXXoXXXXXXXXXXoX"],["XooooooooooooooooooooooooooX"],["XXXXXXXXXXXXXXXXXXXXXXXXXXXX"]],this.maxFps=120,this.tileSize=8,this.scale=this.determineScale(1),this.scaledTileSize=this.tileSize*this.scale,this.firstGame=!0,this.movementKeys={87:"up",83:"down",65:"left",68:"right",38:"up",40:"down",37:"left",39:"right"},this.fruitPoints={1:100,2:300,3:500,4:700,5:1e3,6:2e3,7:3e3,8:5e3},this.mazeArray.forEach((row,rowIndex)=>{this.mazeArray[rowIndex]=row[0].split("")}),this.gameStartButton.addEventListener("click",this.startButtonClick.bind(this)),this.pauseButton.addEventListener("click",this.handlePauseKey.bind(this)),this.soundButton.addEventListener("click",this.soundButtonClick.bind(this));const head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.rel="stylesheet",link.href="build/app.css",link.onload=this.preloadAssets.bind(this),head.appendChild(link)}determineScale(scale){const availableScreenHeight=Math.min(document.documentElement.clientHeight,window.innerHeight||0),availableScreenWidth=Math.min(document.documentElement.clientWidth,window.innerWidth||0),scaledTileSize=this.tileSize*scale,mazeTileHeight=this.mazeArray.length+5,mazeTileWidth=this.mazeArray[0][0].split("").length;return scaledTileSize*mazeTileHeight<availableScreenHeight&&scaledTileSize*mazeTileWidth<availableScreenWidth?this.determineScale(scale+1):scale-1}startButtonClick(){this.leftCover.style.left="-50%",this.rightCover.style.right="-50%",this.mainMenu.style.opacity=0,this.gameStartButton.disabled=!0,setTimeout(()=>{this.mainMenu.style.visibility="hidden"},1e3),this.reset(),this.firstGame&&(this.firstGame=!1,this.init()),this.startGameplay(!0)}soundButtonClick(){const newVolume=1===this.soundManager.masterVolume?0:1;this.soundManager.setMasterVolume(newVolume),localStorage.setItem("volumePreference",newVolume),this.setSoundButtonIcon(newVolume)}setSoundButtonIcon(newVolume){this.soundButton.innerHTML=0===newVolume?"volume_off":"volume_up"}displayErrorMessage(){const loadingContainer=document.getElementById("loading-container"),errorMessage=document.getElementById("error-message");loadingContainer.style.opacity=0,setTimeout(()=>{loadingContainer.remove(),errorMessage.style.opacity=1,errorMessage.style.visibility="visible"},1500)}preloadAssets(){return new Promise(resolve=>{const loadingContainer=document.getElementById("loading-container"),loadingPacman=document.getElementById("loading-pacman"),loadingDotMask=document.getElementById("loading-dot-mask"),imgBase="app/style/graphics/spriteSheets/",imgSources=[`${imgBase}characters/pacman/arrow_down.svg`,`${imgBase}characters/pacman/arrow_left.svg`,`${imgBase}characters/pacman/arrow_right.svg`,`${imgBase}characters/pacman/arrow_up.svg`,`${imgBase}characters/pacman/pacman_death.svg`,`${imgBase}characters/pacman/pacman_error.svg`,`${imgBase}characters/pacman/pacman_down.svg`,`${imgBase}characters/pacman/pacman_left.svg`,`${imgBase}characters/pacman/pacman_right.svg`,`${imgBase}characters/pacman/pacman_up_moretti.png`,`${imgBase}characters/ghosts/blinky/blinky_down_angry.svg`,`${imgBase}characters/ghosts/blinky/blinky_down_annoyed.svg`,`${imgBase}characters/ghosts/blinky/blinky_down.svg`,`${imgBase}characters/ghosts/blinky/blinky_left_angry.svg`,`${imgBase}characters/ghosts/blinky/blinky_left_annoyed.svg`,`${imgBase}characters/ghosts/blinky/blinky_left.svg`,`${imgBase}characters/ghosts/blinky/blinky_right_angry.svg`,`${imgBase}characters/ghosts/blinky/blinky_right_annoyed.svg`,`${imgBase}characters/ghosts/blinky/blinky_right.svg`,`${imgBase}characters/ghosts/blinky/blinky_up_angry.svg`,`${imgBase}characters/ghosts/blinky/blinky_up_annoyed.svg`,`${imgBase}characters/ghosts/blinky/blinky_up.svg`,`${imgBase}characters/ghosts/clyde/clyde_down.svg`,`${imgBase}characters/ghosts/clyde/clyde_left.svg`,`${imgBase}characters/ghosts/clyde/clyde_right.svg`,`${imgBase}characters/ghosts/clyde/clyde_up.svg`,`${imgBase}characters/ghosts/inky/inky_down.svg`,`${imgBase}characters/ghosts/inky/inky_left.svg`,`${imgBase}characters/ghosts/inky/inky_right.svg`,`${imgBase}characters/ghosts/inky/inky_up.svg`,`${imgBase}characters/ghosts/pinky/pinky_down.svg`,`${imgBase}characters/ghosts/pinky/pinky_left.svg`,`${imgBase}characters/ghosts/pinky/pinky_right.svg`,`${imgBase}characters/ghosts/pinky/pinky_up.svg`,`${imgBase}characters/ghosts/eyes_down.svg`,`${imgBase}characters/ghosts/eyes_left.svg`,`${imgBase}characters/ghosts/eyes_right.svg`,`${imgBase}characters/ghosts/eyes_up.svg`,`${imgBase}characters/ghosts/scared_blue.svg`,`${imgBase}characters/ghosts/scared_white.svg`,`${imgBase}pickups/pacdot.svg`,`${imgBase}pickups/powerPellet.svg`,`${imgBase}pickups/apple.svg`,`${imgBase}pickups/bell.svg`,`${imgBase}pickups/cherry.svg`,`${imgBase}pickups/galaxian.svg`,`${imgBase}pickups/key.svg`,`${imgBase}pickups/melon.svg`,`${imgBase}pickups/orange.svg`,`${imgBase}pickups/strawberry.svg`,`${imgBase}text/ready.svg`,`${imgBase}text/100.svg`,`${imgBase}text/200.svg`,`${imgBase}text/300.svg`,`${imgBase}text/400.svg`,`${imgBase}text/500.svg`,`${imgBase}text/700.svg`,`${imgBase}text/800.svg`,`${imgBase}text/1000.svg`,`${imgBase}text/1600.svg`,`${imgBase}text/2000.svg`,`${imgBase}text/3000.svg`,`${imgBase}text/5000.svg`,`${imgBase}maze/maze_blue.svg`,"app/style/graphics/extra_life_moretti.png"],audioBase="app/style/audio/",audioSources=[`${audioBase}game_start.mp3`,`${audioBase}pause.mp3`,`${audioBase}pause_beat.mp3`,`${audioBase}siren_1.mp3`,`${audioBase}siren_2.mp3`,`${audioBase}siren_3.mp3`,`${audioBase}power_up.mp3`,`${audioBase}extra_life.mp3`,`${audioBase}eyes.mp3`,`${audioBase}eat_ghost.mp3`,`${audioBase}death.mp3`,`${audioBase}fruit.mp3`,`${audioBase}dot_1.mp3`,`${audioBase}dot_2.mp3`],totalSources=imgSources.length+audioSources.length;this.remainingSources=totalSources,loadingPacman.style.left="0",loadingDotMask.style.width="0",Promise.all([this.createElements(imgSources,"img",totalSources,this),this.createElements(audioSources,"audio",totalSources,this)]).then(()=>{loadingContainer.style.opacity=0,resolve(),setTimeout(()=>{loadingContainer.remove(),this.mainMenu.style.opacity=1,this.mainMenu.style.visibility="visible"},1500)}).catch(this.displayErrorMessage)})}createElements(sources,type,totalSources,gameCoord){const loadingContainer=document.getElementById("loading-container"),preloadDiv=document.getElementById("preload-div"),loadingPacman=document.getElementById("loading-pacman"),containerWidth=loadingContainer.scrollWidth-loadingPacman.scrollWidth,loadingDotMask=document.getElementById("loading-dot-mask"),gameCoordRef=gameCoord;return new Promise((resolve,reject)=>{let loadedSources=0;sources.forEach(source=>{const element="img"===type?new Image:new Audio;preloadDiv.appendChild(element);const elementReady=()=>{gameCoordRef.remainingSources-=1,loadedSources+=1;const percent=1-gameCoordRef.remainingSources/totalSources;loadingPacman.style.left=`${percent*containerWidth}px`,loadingDotMask.style.width=loadingPacman.style.left,loadedSources===sources.length&&resolve()};"img"===type?(element.onload=elementReady,element.onerror=reject):(element.addEventListener("canplaythrough",elementReady),element.onerror=reject),element.src=source,"audio"===type&&element.load()})})}reset(){this.activeTimers=[],this.points=0,this.level=1,this.lives=2,this.extraLifeGiven=!1,this.remainingDots=0,this.allowKeyPresses=!0,this.allowPacmanMovement=!1,this.allowPause=!1,this.cutscene=!0,this.highScore=localStorage.getItem("highScore"),this.firstGame&&(setInterval(()=>{this.collisionDetectionLoop()},500),this.pacman=new Pacman(this.scaledTileSize,this.mazeArray,new CharacterUtil),this.blinky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"blinky",this.level,new CharacterUtil),this.pinky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"pinky",this.level,new CharacterUtil),this.inky=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"inky",this.level,new CharacterUtil,this.blinky),this.clyde=new Ghost(this.scaledTileSize,this.mazeArray,this.pacman,"clyde",this.level,new CharacterUtil),this.fruit=new Pickup("fruit",this.scaledTileSize,13.5,17,this.pacman,this.mazeDiv,100)),this.entityList=[this.pacman,this.blinky,this.pinky,this.inky,this.clyde,this.fruit],this.ghosts=[this.blinky,this.pinky,this.inky,this.clyde],this.scaredGhosts=[],this.eyeGhosts=0,this.firstGame?(this.drawMaze(this.mazeArray,this.entityList),this.soundManager=new SoundManager,this.setUiDimensions()):(this.pacman.reset(),this.ghosts.forEach(ghost=>{ghost.reset(!0)}),this.pickups.forEach(pickup=>{"fruit"!==pickup.type&&(this.remainingDots+=1,pickup.reset(),this.entityList.push(pickup))})),this.pointsDisplay.innerHTML="00",this.highScoreDisplay.innerHTML=this.highScore||"00",this.clearDisplay(this.fruitDisplay);const volumePreference=parseInt(localStorage.getItem("volumePreference")||1,10);this.setSoundButtonIcon(volumePreference),this.soundManager.setMasterVolume(volumePreference)}init(){this.registerEventListeners(),this.gameEngine=new GameEngine(this.maxFps,this.entityList),this.gameEngine.start()}drawMaze(mazeArray,entityList){this.pickups=[this.fruit],this.mazeDiv.style.height=`${31*this.scaledTileSize}px`,this.mazeDiv.style.width=`${28*this.scaledTileSize}px`,this.gameUi.style.width=`${28*this.scaledTileSize}px`,this.bottomRow.style.minHeight=`${2*this.scaledTileSize}px`,this.dotContainer=document.getElementById("dot-container"),mazeArray.forEach((row,rowIndex)=>{row.forEach((block,columnIndex)=>{if("o"===block||"O"===block){const type="o"===block?"pacdot":"powerPellet",points="o"===block?10:50,dot=new Pickup(type,this.scaledTileSize,columnIndex,rowIndex,this.pacman,this.dotContainer,points);entityList.push(dot),this.pickups.push(dot),this.remainingDots+=1}})})}setUiDimensions(){this.gameUi.style.fontSize=`${this.scaledTileSize}px`,this.rowTop.style.marginBottom=`${this.scaledTileSize}px`}collisionDetectionLoop(){if(this.pacman.position){const maxDistance=750*this.pacman.velocityPerMs,pacmanCenter={x:this.pacman.position.left+this.scaledTileSize,y:this.pacman.position.top+this.scaledTileSize},debugging=!1;this.pickups.forEach(pickup=>{pickup.checkPacmanProximity(maxDistance,pacmanCenter,debugging)})}}startGameplay(initialStart){initialStart&&this.soundManager.play("game_start"),this.scaredGhosts=[],this.eyeGhosts=0,this.allowPacmanMovement=!1;const left=11*this.scaledTileSize,top=16.5*this.scaledTileSize,duration=initialStart?4500:2e3,width=6*this.scaledTileSize,height=2*this.scaledTileSize;this.displayText({left:left,top:top},"ready",duration,width,height),this.updateExtraLivesDisplay(),new Timer(()=>{this.allowPause=!0,this.cutscene=!1,this.soundManager.setCutscene(this.cutscene),this.soundManager.setAmbience(this.determineSiren(this.remainingDots)),this.allowPacmanMovement=!0,this.pacman.moving=!0,this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.moving=!0}),this.ghostCycle("scatter"),this.idleGhosts=[this.pinky,this.inky,this.clyde],this.releaseGhost()},duration)}clearDisplay(display){for(;display.firstChild;)display.removeChild(display.firstChild)}updateExtraLivesDisplay(){this.clearDisplay(this.extraLivesDisplay);for(let i=0;i<this.lives;i+=1){const extraLifePic=document.createElement("img");extraLifePic.setAttribute("src","app/style/graphics/extra_life_moretti.png"),extraLifePic.style.height=`${2*this.scaledTileSize}px`,this.extraLivesDisplay.appendChild(extraLifePic)}}updateFruitDisplay(rawImageSource){const parsedSource=rawImageSource.slice(rawImageSource.indexOf("(")+1,rawImageSource.indexOf(")"));7===this.fruitDisplay.children.length&&this.fruitDisplay.removeChild(this.fruitDisplay.firstChild);const fruitPic=document.createElement("img");fruitPic.setAttribute("src",parsedSource),fruitPic.style.height=`${2*this.scaledTileSize}px`,this.fruitDisplay.appendChild(fruitPic)}ghostCycle(mode){const delay="scatter"===mode?7e3:2e4,nextMode="scatter"===mode?"chase":"scatter";this.ghostCycleTimer=new Timer(()=>{this.ghosts.forEach(ghost=>{ghost.changeMode(nextMode)}),this.ghostCycle(nextMode)},delay)}releaseGhost(){if(this.idleGhosts.length>0){const delay=Math.max(1e3*(8-4*(this.level-1)),0);this.endIdleTimer=new Timer(()=>{this.idleGhosts[0].endIdleMode(),this.idleGhosts.shift()},delay)}}registerEventListeners(){window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("awardPoints",this.awardPoints.bind(this)),window.addEventListener("deathSequence",this.deathSequence.bind(this)),window.addEventListener("dotEaten",this.dotEaten.bind(this)),window.addEventListener("powerUp",this.powerUp.bind(this)),window.addEventListener("eatGhost",this.eatGhost.bind(this)),window.addEventListener("restoreGhost",this.restoreGhost.bind(this)),window.addEventListener("addTimer",this.addTimer.bind(this)),window.addEventListener("removeTimer",this.removeTimer.bind(this)),window.addEventListener("releaseGhost",this.releaseGhost.bind(this));const directions=["up","down","left","right"];directions.forEach(direction=>{document.getElementById(`button-${direction}`).addEventListener("touchstart",()=>{this.changeDirection(direction)})})}changeDirection(direction){this.allowKeyPresses&&this.gameEngine.running&&this.pacman.changeDirection(direction,this.allowPacmanMovement)}handleKeyDown(e){27===e.keyCode?this.handlePauseKey():81===e.keyCode?this.soundButtonClick():this.movementKeys[e.keyCode]&&this.changeDirection(this.movementKeys[e.keyCode])}handlePauseKey(){this.allowPause&&(this.allowPause=!1,setTimeout(()=>{this.cutscene||(this.allowPause=!0)},500),this.gameEngine.changePausedState(this.gameEngine.running),this.soundManager.play("pause"),this.gameEngine.started?(this.soundManager.resumeAmbience(),this.gameUi.style.filter="unset",this.movementButtons.style.filter="unset",this.pausedText.style.visibility="hidden",this.pauseButton.innerHTML="pause",this.activeTimers.forEach(timer=>{timer.resume()})):(this.soundManager.stopAmbience(),this.soundManager.setAmbience("pause_beat",!0),this.gameUi.style.filter="blur(5px)",this.movementButtons.style.filter="blur(5px)",this.pausedText.style.visibility="visible",this.pauseButton.innerHTML="play_arrow",this.activeTimers.forEach(timer=>{timer.pause()})))}awardPoints(e){if(this.points+=e.detail.points,this.pointsDisplay.innerText=this.points,this.points>(this.highScore||0)&&(this.highScore=this.points,this.highScoreDisplay.innerText=this.points,localStorage.setItem("highScore",this.highScore)),this.points>=1e4&&!this.extraLifeGiven&&(this.extraLifeGiven=!0,this.soundManager.play("extra_life"),this.lives+=1,this.updateExtraLivesDisplay()),"fruit"===e.detail.type){const left=e.detail.points>=1e3?12.5*this.scaledTileSize:13*this.scaledTileSize,top=16.5*this.scaledTileSize,width=e.detail.points>=1e3?3*this.scaledTileSize:2*this.scaledTileSize,height=2*this.scaledTileSize;this.displayText({left:left,top:top},e.detail.points,2e3,width,height),this.soundManager.play("fruit"),this.updateFruitDisplay(this.fruit.determineImage("fruit",e.detail.points))}}deathSequence(){this.allowPause=!1,this.cutscene=!0,this.soundManager.setCutscene(this.cutscene),this.soundManager.stopAmbience(),this.removeTimer({detail:{timer:this.fruitTimer}}),this.removeTimer({detail:{timer:this.ghostCycleTimer}}),this.removeTimer({detail:{timer:this.endIdleTimer}}),this.removeTimer({detail:{timer:this.ghostFlashTimer}}),this.allowKeyPresses=!1,this.pacman.moving=!1,this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.moving=!1}),new Timer(()=>{this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.display=!1}),this.pacman.prepDeathAnimation(),this.soundManager.play("death"),this.lives>0?(this.lives-=1,new Timer(()=>{this.mazeCover.style.visibility="visible",new Timer(()=>{this.allowKeyPresses=!0,this.mazeCover.style.visibility="hidden",this.pacman.reset(),this.ghosts.forEach(ghost=>{ghost.reset()}),this.fruit.hideFruit(),this.startGameplay()},500)},2250)):this.gameOver()},750)}gameOver(){localStorage.setItem("highScore",this.highScore),new Timer(()=>{this.displayText({left:9*this.scaledTileSize,top:16.5*this.scaledTileSize},"game_over",4e3,10*this.scaledTileSize,2*this.scaledTileSize),this.fruit.hideFruit(),new Timer(()=>{this.leftCover.style.left="0",this.rightCover.style.right="0",setTimeout(()=>{this.mainMenu.style.opacity=1,this.gameStartButton.disabled=!1,this.mainMenu.style.visibility="visible"},1e3)},2500)},2250)}dotEaten(){this.remainingDots-=1,this.soundManager.playDotSound(),174!==this.remainingDots&&74!==this.remainingDots||this.createFruit(),40!==this.remainingDots&&20!==this.remainingDots||this.speedUpBlinky(),0===this.remainingDots&&this.advanceLevel()}createFruit(){this.removeTimer({detail:{timer:this.fruitTimer}}),this.fruit.showFruit(this.fruitPoints[this.level]||5e3),this.fruitTimer=new Timer(()=>{this.fruit.hideFruit()},1e4)}speedUpBlinky(){this.blinky.speedUp(),0===this.scaredGhosts.length&&0===this.eyeGhosts&&this.soundManager.setAmbience(this.determineSiren(this.remainingDots))}determineSiren(remainingDots){let sirenNum;return sirenNum=remainingDots>40?1:remainingDots>20?2:3,`siren_${sirenNum}`}advanceLevel(){this.allowPause=!1,this.cutscene=!0,this.soundManager.setCutscene(this.cutscene),this.allowKeyPresses=!1,this.soundManager.stopAmbience(),this.entityList.forEach(entity=>{const entityRef=entity;entityRef.moving=!1}),this.removeTimer({detail:{timer:this.fruitTimer}}),this.removeTimer({detail:{timer:this.ghostCycleTimer}}),this.removeTimer({detail:{timer:this.endIdleTimer}}),this.removeTimer({detail:{timer:this.ghostFlashTimer}});const imgBase="app/style//graphics/spriteSheets/maze/";new Timer(()=>{this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.display=!1}),this.mazeImg.src=`${imgBase}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${imgBase}maze_blue.svg`,new Timer(()=>{this.mazeImg.src=`${imgBase}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${imgBase}maze_blue.svg`,new Timer(()=>{this.mazeImg.src=`${imgBase}maze_white.svg`,new Timer(()=>{this.mazeImg.src=`${imgBase}maze_blue.svg`,new Timer(()=>{this.mazeCover.style.visibility="visible",new Timer(()=>{this.mazeCover.style.visibility="hidden",this.level+=1,this.allowKeyPresses=!0,this.entityList.forEach(entity=>{const entityRef=entity;entityRef.level&&(entityRef.level=this.level),entityRef.reset(),entityRef instanceof Ghost&&entityRef.resetDefaultSpeed(),entityRef instanceof Pickup&&"fruit"!==entityRef.type&&(this.remainingDots+=1)}),this.startGameplay()},500)},250)},250)},250)},250)},250)},250)},2e3)}flashGhosts(flashes,maxFlashes){flashes===maxFlashes?(this.scaredGhosts.forEach(ghost=>{ghost.endScared()}),this.scaredGhosts=[],0===this.eyeGhosts&&this.soundManager.setAmbience(this.determineSiren(this.remainingDots))):this.scaredGhosts.length>0&&(this.scaredGhosts.forEach(ghost=>{ghost.toggleScaredColor()}),this.ghostFlashTimer=new Timer(()=>{this.flashGhosts(flashes+1,maxFlashes)},250))}powerUp(){0!==this.remainingDots&&this.soundManager.setAmbience("power_up"),this.removeTimer({detail:{timer:this.ghostFlashTimer}}),this.ghostCombo=0,this.scaredGhosts=[],this.ghosts.forEach(ghost=>{"eyes"!==ghost.mode&&this.scaredGhosts.push(ghost)}),this.scaredGhosts.forEach(ghost=>{ghost.becomeScared()});const powerDuration=Math.max(1e3*(7-this.level),0);this.ghostFlashTimer=new Timer(()=>{this.flashGhosts(0,9)},powerDuration)}determineComboPoints(){return 100*2**this.ghostCombo}eatGhost(e){const pauseDuration=1e3,{position:position,measurement:measurement}=e.detail.ghost;this.pauseTimer({detail:{timer:this.ghostFlashTimer}}),this.pauseTimer({detail:{timer:this.ghostCycleTimer}}),this.pauseTimer({detail:{timer:this.fruitTimer}}),this.soundManager.play("eat_ghost"),this.scaredGhosts=this.scaredGhosts.filter(ghost=>ghost.name!==e.detail.ghost.name),this.eyeGhosts+=1,this.ghostCombo+=1;const comboPoints=this.determineComboPoints();window.dispatchEvent(new CustomEvent("awardPoints",{detail:{points:comboPoints}})),this.displayText(position,comboPoints,1e3,measurement),this.allowPacmanMovement=!1,this.pacman.display=!1,this.pacman.moving=!1,e.detail.ghost.display=!1,e.detail.ghost.moving=!1,this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.animate=!1,ghostRef.pause(!0),ghostRef.allowCollision=!1}),new Timer(()=>{this.soundManager.setAmbience("eyes"),this.resumeTimer({detail:{timer:this.ghostFlashTimer}}),this.resumeTimer({detail:{timer:this.ghostCycleTimer}}),this.resumeTimer({detail:{timer:this.fruitTimer}}),this.allowPacmanMovement=!0,this.pacman.display=!0,this.pacman.moving=!0,e.detail.ghost.display=!0,e.detail.ghost.moving=!0,this.ghosts.forEach(ghost=>{const ghostRef=ghost;ghostRef.animate=!0,ghostRef.pause(!1),ghostRef.allowCollision=!0})},1e3)}restoreGhost(){if(this.eyeGhosts-=1,0===this.eyeGhosts){const sound=this.scaredGhosts.length>0?"power_up":this.determineSiren(this.remainingDots);this.soundManager.setAmbience(sound)}}displayText(position,amount,duration,width,height){const pointsDiv=document.createElement("div");pointsDiv.style.position="absolute",pointsDiv.style.backgroundSize=`${width}px`,pointsDiv.style.backgroundImage="url(app/style/graphics/"+`spriteSheets/text/${amount}.svg`,pointsDiv.style.width=`${width}px`,pointsDiv.style.height=`${height||width}px`,pointsDiv.style.top=`${position.top}px`,pointsDiv.style.left=`${position.left}px`,pointsDiv.style.zIndex=2,this.mazeDiv.appendChild(pointsDiv),new Timer(()=>{this.mazeDiv.removeChild(pointsDiv)},duration)}addTimer(e){this.activeTimers.push(e.detail.timer)}timerExists(e){return!!(e.detail.timer||{}).timerId}pauseTimer(e){this.timerExists(e)&&e.detail.timer.pause(!0)}resumeTimer(e){this.timerExists(e)&&e.detail.timer.resume(!0)}removeTimer(e){this.timerExists(e)&&(window.clearTimeout(e.detail.timer.timerId),this.activeTimers=this.activeTimers.filter(timer=>timer.timerId!==e.detail.timer.timerId))}}module.exports=GameCoordinator;
//# sourceMappingURL=gameCoordinator.min.js.map